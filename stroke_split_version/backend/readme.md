# Stroke Split Version Backend
## QuickStart:
1. The steps for quick deployment are as follows:
Before starting, please complete the following steps:
- Download base_train_data and unzip it. Place all the images inside in the folder alg/style_transfer/zi2zi/base_train_data in the project directory. Download link is as follows: https://zjueducn-my.sharepoint.com/:u:/g/personal/21921307_zju_edu_cn/EYo6vXCYnodKtQQKSja4NlMBrcuRDKwBkJCFZbXV5xH4NA?e=UueuPd (Alternate link：https://gofile.me/73DMg/SDi5n3U4e)
- Based on existing open-source community solutions and fine-tuning guidelines, fine-tune the open-source Stable Diffusion pre-trained weights using batch-exported Chinese character images from the font. For specific fine-tuning guidelines, you can refer to: https://huggingface.co/docs/diffusers/training/text2image. Please save the trained model to the 'alg/style_transfer/stablediffusion/base_model' folder in the project directory after training is complete.
- Execute "accelerate config" to determine the GPU precision used by StableDiffusion Finetune.
 
2. Prepare Env：
```
conda create -n font_generator python=3.9
conda activate font_generator
pip install -r requirements.txt
```
3. modify config.py
4. run main app
```
python app.py
```

## Repository Introduction：
1. The content related to algorithms is located within the 'alg' folder. The 'style_transfer' folder contains bitmap inference, including content related to 'zi2zi' inference and 'stablediffusion'. The 'stroke_assemble' folder contains vectorization stroke segmentation algorithms.
2. The 'data' folder contains 'zips' and 'upload_imgs' subfolders, which serve as temporary directories for the user-uploaded content.
3. The 'result_data' folder contains files generated from each system run, which are named according to their respective timestamps. The structure inside the folder includes relevant result files.- 2023-08-15 18-21-43

- 2023-08-15 18-21-43
    - style_transfer
        - stroke_assemble
            - img_for_train
            - json_assemble
            - json_stroke_dataset_var
            - json_with_moments_var
            - runs_log
            - split_result
            - stroke_img_var
        - sd_finetune
            - infer_result
            - logging
            - model
        - zi2zi_finetune
            - data
            - finetune
            - infer_data
            - train_result
4. Under normal circumstances, the system adopts an all-in-one solution, where training and display are integrated. Users upload a compressed package from the front end, and then directly perform vectorization operations in the front end after waiting for the back end training to be completed. However, if the user has already completed training and inference and only wants to perform vectorization operations, they can follow the steps below: Open the 'is_preview' mode in 'config.py' and place the files generated by the training algorithm in the corresponding directory under 'result_data/preview'. The specific steps are as follows:
For example, if a series of JSON files have been generated by the stroke segmentation network inference, then they should be named 'character.json'. Modify the 'charset' in 'config.py' according to the corresponding character set, for example, if the only character is '你', then 'charset='你''. Place these images in the directory 'result_data/preview/stroke_assemble/json_assemble'. In preview mode, other directories can be empty. The front end can be opened to start the vectorization process directly.

Example:
a) Please download json file from this link：https://zjueducn-my.sharepoint.com/:u:/r/personal/21921307_zju_edu_cn/Documents/NextLab/2023%E5%AD%97%E4%BD%93%E7%BB%84%E8%8B%B9%E6%9E%9C%E9%A1%B9%E7%9B%AE%E6%9D%90%E6%96%99/stroke_split_version_preview_data.tar.gz?csf=1&web=1&e=5h3Zfo
(alternative link：https://gofile.me/73DMg/E2tPZyrxv)
b) Unzip the compressed package and place all JSON files in the directory 'result_data/preview/stroke_assemble/json_assemble'. 
c) Change 'is_preview' to 'True' in 'config.py' and modify the 'charset' to '阿唉艾爱隘'; charset can be changed. 
d) Proceed to the 'frontend' directory to continue the operation.
